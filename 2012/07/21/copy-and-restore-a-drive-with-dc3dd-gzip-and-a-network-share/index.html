<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.1.1" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.1.1" type="image/png" sizes="32x32"><meta name="description" content="In the past I’ve written about combining dd, Gzip and OpenSSH to image a drive over a network, while the above works just fine there are better tools available that can improve the results or at least">
<meta property="og:type" content="article">
<meta property="og:title" content="Copy and Restore a Drive with Dc3dd, Gzip and a Network Share">
<meta property="og:url" content="http://linhost.info/2012/07/21/copy-and-restore-a-drive-with-dc3dd-gzip-and-a-network-share/index.html">
<meta property="og:site_name" content="Linhost.info">
<meta property="og:description" content="In the past I’ve written about combining dd, Gzip and OpenSSH to image a drive over a network, while the above works just fine there are better tools available that can improve the results or at least">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://cdn.linhost.info/static/ws2003-img.png">
<meta property="article:published_time" content="2012-07-21T23:30:11.000Z">
<meta property="article:modified_time" content="2020-08-09T09:07:53.841Z">
<meta property="article:author" content="Moody Gent">
<meta property="article:tag" content="gzip">
<meta property="article:tag" content="dc3dd">
<meta property="article:tag" content="smb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.linhost.info/static/ws2003-img.png"><title>Copy and Restore a Drive with Dc3dd, Gzip and a Network Share | Linhost.info</title><link ref="canonical" href="http://linhost.info/2012/07/21/copy-and-restore-a-drive-with-dc3dd-gzip-and-a-network-share/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.1.1"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><script src="https://www.googletagmanager.com/gtag/js?id=UA-12345678-9" async=""></script><script>if (window.location.hostname !== 'localhost') {
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-12345678-9');
}</script><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="Linhost.info" type="application/atom+xml">
</head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/test"><span class="header-nav-menu-item__text">menu.Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/atom.xml"><span class="header-nav-menu-item__text">menu.RSS</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Linhost.info</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Copy and Restore a Drive with Dc3dd, Gzip and a Network Share</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2012-07-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2020-08-09</span></span></div></header><div class="post-body"><p>In the past I’ve written about combining dd, Gzip and OpenSSH to image a drive over a network, while the above works just fine there are better tools available that can improve the results or at least make it easier to clone a drive. By better I mean:</p>
<ol>
<li>Unlike dd, Dc3dd comes with a progress indicator</li>
<li>With Gigabit links OpenSSH appears to become the bottleneck, even when resources are available network throughput is low</li>
</ol>

        <h3 id="Keep-in-mind"   >
          <a href="#Keep-in-mind" class="heading-link"><i class="fas fa-link"></i></a>Keep in mind</h3>
      <p>Before we start the tutorial I recommend using a one of the many available Live-CD distributions like <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://partedmagic.com/doku.php?id=start" >Parted Magic</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.deftlinux.net/" >Deft Linux</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> because they include all the tools I’ll be using in this post. This tutorial assumes a working network share is already available. The process for imaging a drive over a network revolves around five commands ls, Dc3dd, Gzip, Gunzip and mount.cifs.</p>

        <h3 id="Prepare"   >
          <a href="#Prepare" class="heading-link"><i class="fas fa-link"></i></a>Prepare</h3>
      <p>Locate the drive you need to image, we can use the ls command to list all available drives and their respective partitions, decide whether you need to copy the partitions or the entire drive.</p>
<p># ls /dev/sd*</p>
<p>/dev/sda   /dev/sda1  /dev/sda2  /dev/sdb   /dev/sdb1</p>
<p>* <em>/dev/sda and /dev/sda represent the actual drive, /dev/sda1/2 and /dev/sdb1 represent a partition within the drive</em>. Create a mount point for the network share.</p>
<p># mkdir /media/netshare</p>
<p>Mount the network share.</p>
<p># mount.cifs //192.168.1.8/072012/ /media/netshare/ -o user=tempuser,password=tempuser</p>
<p>Change the following:</p>
<ol>
<li><strong>mount.cifs //192.168.1.8/072012/</strong> - This is the network share IP address and share name</li>
<li>/<strong>media/netshare/</strong> - This is the mount point we created with <em>mkdir</em>.</li>
<li><strong>-o user=tempuser,password=tempuser</strong> - This is the username and password for the network share</li>
</ol>
<p>Verify that the network share mounted successfully.</p>
<p># df -h</p>
<p>Filesystem            Size  Used Avail Use% Mounted on<br>/dev/sdb1             2.0G  8.0K  2.0G   1% /media/usb<br>//192.168.1.8/072012/<br>                       80G   23G   58G  29% /media/netshare</p>

        <h3 id="Copy"   >
          <a href="#Copy" class="heading-link"><i class="fas fa-link"></i></a>Copy</h3>
      <p>Star imaging or cloning the drive, compress and direct the output to the network share mount point.</p>
<p># dc3dd if=/dev/sda progress=on | gzip -1 &gt; /media/netshare/sda.img.gz</p>
<p>warning: sector size not probed, assuming 512<br>dc3dd 6.12.3 started at 2012-07-21 07:11:13 +0000<br>command line: dc3dd if=/dev/sda progress=on<br>compiled options: DEFAULT_BLOCKSIZE=32768<br>sector size: 512 (assumed)<br>9830400+0 sectors in<br>9830400+0 sectors out<br>5033164800 bytes (4.7 G) copied (??%), 444.728 s, 11 M/s<br>dc3dd completed at 2012-07-21 07:18:39 +0000</p>
<ol>
<li><strong>dc3dd if=/dev/sda</strong> - Dc3dd will work with drive /dev/sda</li>
<li><strong>progress=on</strong> - Dc3dd will display the progress</li>
<li><strong>gzip -1 &gt;</strong> - Gzip will be used for compression, -1 means fast compression</li>
<li><strong>/media/netshare/sda.img.gz</strong> - This is the network share path</li>
</ol>
<p>My network share is in a Windows Server 2003 and as you can see the image was successfully created and compressed. <img src="http://cdn.linhost.info/static/ws2003-img.png"></p>

        <h3 id="Restore"   >
          <a href="#Restore" class="heading-link"><i class="fas fa-link"></i></a>Restore</h3>
      <p>To restore the image we use Gunzip to decompress and Dc3dd to write the decompressed data over to the target disk. I recommend using the <em>progress=on</em> option when working with large images, its nice to have an idea of the progress being made.</p>
<p># gunzip -c /media/netshare/sda.img.gz | dc3dd of=/dev/sda progress=on</p>
<p>warning: sector size not probed, assuming 512<br>dc3dd 6.12.3 started at 2012-07-21 22:55:04 +0000<br>command line: dc3dd of=/dev/sda<br>compiled options: DEFAULT_BLOCKSIZE=32768<br>sector size: 512 (assumed)<br>9830400+0 sectors in<br>9830400+0 sectors out<br>5033164800 bytes (4.7 G) copied (??%), 192.915 s, 25 M/s<br>dc3dd completed at 2012-07-21 22:58:19 +0000</p>

        <h3 id="Conclusion"   >
          <a href="#Conclusion" class="heading-link"><i class="fas fa-link"></i></a>Conclusion</h3>
      <p>This is my preferred method for imaging drives over the network because the tools required to copy and restore are easily found in most distributions. If you have any questions feel free comment below.</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="http://linhost.info">Moody Gent</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="http://linhost.info/2012/07/21/copy-and-restore-a-drive-with-dc3dd-gzip-and-a-network-share/">http://linhost.info/2012/07/21/copy-and-restore-a-drive-with-dc3dd-gzip-and-a-network-share/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://linhost.info/tags/gzip/">gzip</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://linhost.info/tags/dc3dd/">dc3dd</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://linhost.info/tags/smb/">smb</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2012/07/23/scan-a-drive-for-errors-with-hd-tune/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">Scan a Drive for Errors with HD Tune</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2012/07/21/new-comment-system/"><span class="paginator-prev__text">New Comment System</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Keep-in-mind"><span class="toc-number">1.</span> <span class="toc-text">
          Keep in mind</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare"><span class="toc-number">2.</span> <span class="toc-text">
          Prepare</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Copy"><span class="toc-number">3.</span> <span class="toc-text">
          Copy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Restore"><span class="toc-number">4.</span> <span class="toc-text">
          Restore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-number">5.</span> <span class="toc-text">
          Conclusion</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">357</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2020</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Moody Gent</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.0.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.1.1</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.1.1"></script><script src="/js/stun-boot.js?v=2.1.1"></script><script src="/js/scroll.js?v=2.1.1"></script><script src="/js/header.js?v=2.1.1"></script><script src="/js/sidebar.js?v=2.1.1"></script></body></html>